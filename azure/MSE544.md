# Azure Functions: Serverless computing on the cloud

This tutorial follows a very minimalist path to a working example of serverless,
owing to time constraints. We suggest viewing this as in introductory step to 
developing a comprehensive cloud computing skill set. 


## Links


kilroy update


- [Slides](https://docs.google.com/presentation/d/1R2HHfHYgmarje2q_0x42hMecUc7R6SFjI-ih1L05foQ/edit#slide=id.p)
- [Padlet for communications](https://padlet.com/robfatland/serverless-csj3n88h2osgrru9)
- [This tutorial](https://github.com/robfatland/serverless/blob/main/azure/tutorial.md)


#### Software Installation Guides


kilroy update



- Installing [VSCode](https://code.visualstudio.com/)
- Installing the [Azure Functions Core Tools Extension in VSCode](https://github.com/Azure/azure-functions-core-tools#installing)
- Installing [.Net Core](https://dotnet.microsoft.com/download) may help with VSCode on a Mac


#### Reference Documentation


kilroy update



- [Microsoft Azure Functions overview](https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview)
- [Microsoft Azure Functions general structure](https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference)
- [Microsoft Azure Functions specifically with Python](https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-python)
- [What Azure Functions cost](https://azure.microsoft.com/en-us/pricing/details/functions/)
- [YouTube video on Azure Function best practices (and more)](https://youtu.be/kvTostlJp7M)


#### Further reading


kilroy update



- [Serverless function design pattern introduction](https://www.twilio.com/docs/glossary/what-is-serverless-architecture)
- [An interesting blog on using Serverless Functions for deep learning](https://www.serverless.com/blog/using-tensorflow-serverless-framework-deep-learning-image-recognition)
- [Code golf Sudoku solver blog by Jake VanDerplas](https://jakevdp.github.io/blog/2013/04/15/code-golf-in-python-sudoku/) 
- [Rustem Feyzkhanov's GitHub Lambda (AWS Serverless) adaptations library](https://github.com/ryfeus/lambda-packs)


## Table of Contents



kilroy update



* [Overview](#overview)
* [1: Establish access to an Azure Subscription](#1-establish-access-to-an-azure-subscription)
* [2: Portal work](#2-portal-work)
* [3: Aside on templates and code](#3-aside-on-templates-and-code)
* [4: Switching to Visual Studio Code (VSCode)](#4-switching-to-visual-studio-code-vscode)
* [5: Installing Python and Extensions](#5-installing-python-and-extensions)
* [6: Creating an Azure Function in VSCode](#6-creating-an-azure-function-in-vscode)
* [7: Code break](#7-code-break)
* [8: Test locally](#8-test-locally)
* [9: Deploy to Azure](#9-deploy-to-azure)
* [10: Programmatic test](#10-programmatic-test)
* [Appendices](#appendices)
    + [Longer Overview of Serverless](#longer-overview-of-serverless-computing-and-azure-serverless-functions)
    + [Stretch Problem 1: Timing an Azure Function](#stretch-problem-1)
    + [Stretch Problem 2: Expanding an Azure Function](#stretch-problem-2)
    + [Stretch Problem 3: Binding an Azure Function](#stretch-problem-3)
    + [Docker review](#docker-review)
    + [Containers and Linux (WSL 2) on Windows](#understanding-docker-in-relation-to-wsl-2)
    + [Stretch Problem 1 example results](#stretch-problem-1-example-results)



## The plan


This section is some 'looking ahead' text to frame where we are going. 


* Goal: Build some compute functionality on the (Azure) cloud without bothering with a server
    * A server is a computer that listens for traffic and responds; it requires some care and feeding
    * If we succeed: We get to skip the care and feeding
* Brand name on Azure for 'serverless', what we are building, is an ***Azure Function***


kilroy distinguish Function and Function App


* Milestone 1: Use the Azure portal to set up a Hello World Azure function using only a web browser
* Milestone 2: Set up your personal computer as a Developer environment
    * From this environment you build locally, test locally, and then push the resulting Azure Function to the cloud
    * The Azure Function you build here goes a bit beyond a trivial hello world example
* Milestone 3: Test the Azure Function on the cloud and internalize some debugging skills


* Serverless on the cloud (here: Azure Functions): **Low hassle, Secure, Scalable, $Cheap**
* Serverless on the cloud requires a **trigger**: Example: An alarm clock or a web request can be a trigger.
* We want to pay attention during development: How system feedback helps us debug.
* Serverless is in general *simpler* tasks compared to what we do with *containers*. 


Looking ahead to using the **VSCode** application: There are a number of **views** (panels) that enable
your work. For example there is the **`EXPLORER`** view that shows you files in a folder; and there is an
**`AZURE`** view that shows you both a **`RESOURCES`** list and a **`WORKSPACE`** (both sub-views). So 
if you wind up not seeing the view you need: Switch the view. This is often done using a vertical strip
of icons on the left edge of the VSCode application window.


> A possible point of confusion: We use the term 'serverless' to emphasize the mindset of working
> with Azure Functions: We put together the code and let Azure worry about the computer that it will
> run on. **However** in the course of developing the Function on your own laptop: You *do* need a
> server. What is that server? That server *is* your laptop, pretending to be a server in the 
> cloud. So as you go through this tutorial: Be on the lookout for when VSCode hands you a URL to
> try out in your browser. It will start with **`localhost`** and it will point your browser to a
> little server running on your laptop. 



### Azure


* One of the primary public clouds; many well-designed, proven features
    * [VSCode Integrated Development Environment](https://code.visualstudio.com/) is well-regarded and effective
* Jargon: *Scalable* means that the cloud can handle large demand by making lots of copies of an Azure Function to run in parallel.
* Serverless automatically makes copies of itself to meet demand


***Facets of this topic***


* Azure function components: Storage account, code base, configuration files, ...
* __init__.py is the *recipe*. Don't change it unless you know how. 
* Security: *Anonymous* users have no authentication required
* Python environments, configuration via `requirements.txt`
* Windows Python 3.8+ 64-bit PATH, PYTHONPATH: Can be a challenge
* Thematic: Templates and automation versus by-hand
* On HTTP triggers: GET and POST are distinct *types*. Example code has “body parse” component; see the Appendix
* Where can results go? HTTP response, a new file in a Storage Account; or a line appended to an existing file; or a new entry in a database table
* More security: Private environment variables; key vault; etc: How to get code to GitHub safely?
* Debugging: Where does `logging.info` go?



We walk through building a simple serverless utility on the Azure cloud called an *Azure Function*. 
Since we publish code with no contact with a virtual machine en route this kind of service is
called 'serverless'. There is a server but we just don't worry about it at all.


**A note on using the Azure portal**: Portal procedure is covered in part 2 of this walk-through. If you
are not interested in working with and learning about the Azure portal you can 
skip to 
[*section 4*](#4-switching-to-visual-studio-code).


**A note on 'Development System'**: Your Development System is a computer including its operating system;
where you develop code for deployment to Azure Functions.
It may be your laptop; it may be a Docker container; it may be a cloud VM; it may be a large pile of coconuts. 
Whatever it is you will need this Development System to follow along on this walkthrough. In parts 4 and 5 we 
describe what you will need to install there; so please go through that in preparation. 

